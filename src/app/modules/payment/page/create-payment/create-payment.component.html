<ng-container *ngIf="(neighbors$ | async) as neighbors; else loading">
	<fieldset [disabled]="isLoading" *ngIf="neighbors.length > 0; else noNeighbors">
	    <form (ngSubmit)="createPayment()" [formGroup]="paymentForm">
	        <div class="flex-container">
	          <div class="form-controls-container">
	            <h2 class="secondary-heading">Datos de vecino</h2>          
	              <mat-form-field>
	                <input matInput [placeholder]="'Vecino'" formControlName="neighbor" [matAutocomplete]="autoNeighbor" (change)="neighborInputChange($event)" required>
	                <mat-autocomplete autoActiveFirstOption [displayWith]="displayNeighborName" (optionSelected)="neighborOptionSelected($event)" #autoNeighbor="matAutocomplete">
	                  <mat-option *ngFor="let neighbor of filteredNeighbors$ | async" [value]="neighbor">
	                    {{neighbor.fullName}}
	                  </mat-option>
	                </mat-autocomplete>
	                <app-control-messages [control]="f['neighbor']"></app-control-messages>        
	              </mat-form-field>
	              <mat-form-field>
	                <input matInput readonly="true" [placeholder]="'Cedula'" formControlName="neighborID" required>
	                <app-control-messages [control]="f['neighborID']"></app-control-messages>
	              </mat-form-field>
	          </div>
	          <div class="form-controls-container"> 
	            <h2 class="secondary-heading">Datos del pago</h2>
	            <mat-form-field appearance="fill">
	              <mat-label>Selecciona una fecha</mat-label>
	              <input matInput [matDatepicker]="picker" formControlName="paymentDate" required>
	              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
	              <mat-datepicker #picker></mat-datepicker>
	              <app-control-messages [control]="f['paymentDate']"></app-control-messages>
	            </mat-form-field>
	            <mat-form-field appearance="fill">
	              <mat-label>Tipo de pago</mat-label>
	              <select matNativeControl (change)="paymentMethodChange($event)" formControlName="paymentMethod" required>
	                <option 
	                  *ngFor="let method of paymentMethods" 
	                  [value]="method" 
	                >
	                  {{method}}
	                </option>
	              </select>
	              <app-control-messages [control]="f['paymentMethod']"></app-control-messages>   
	            </mat-form-field>
	            <ng-container *ngIf="isElectronicPayment">
	              <mat-form-field appearance="fill">
	                <mat-label>Banco</mat-label>
	                <select matNativeControl formControlName="bank" required>
	                    <option *ngFor="let bank of banks$ | async" [value]="bank">
	                    {{bank}}
	                    </option>
	                </select>
	                <app-control-messages [control]="f['bank']"></app-control-messages>   
	              </mat-form-field>  
	              <mat-form-field>
	                <input matInput [placeholder]="'Numero de referencia'" formControlName="paymentID" required>
	                <app-control-messages [control]="f['paymentID']"></app-control-messages>
	              </mat-form-field>
	            </ng-container>
	            <mat-form-field>
	              <input type="text" matInput  [placeholder]="'Monto'" formControlName="amount">
	              <app-control-messages [control]="f['amount']"></app-control-messages>
	            </mat-form-field>
	          </div>
	          <div class="form-controls-container" *ngIf="(monthlyPayments$ | async) as monthlyPayments">
	            <h2 class="secondary-heading">Mensualidades por pagar</h2>
	            <mat-form-field appearance="fill">
	              <mat-label>Mensualidades</mat-label>
	              <mat-select formControlName="monthlyPayments" multiple>
	                <mat-option *ngFor="let item of monthlyPayments" [value]="item">{{item.month}} {{item.year}}</mat-option>
	              </mat-select>       
	            </mat-form-field>
	          </div>
	          <div class="form-controls-container" *ngIf="(repairs$ | async) as repairs">
	            <h2 class="secondary-heading">Reparaciones por pagar</h2>
	            <mat-form-field appearance="fill">
	              <mat-label>Reparaciones</mat-label>
	              <mat-select formControlName="repairs" multiple>
	                <mat-option *ngFor="let item of repairs" [value]="item">{{item.title}} - {{item.cost}}</mat-option>
	              </mat-select>   
	            </mat-form-field>
	          </div>
	          <div class="form-controls-container" *ngIf="(contributions$ | async) as contributions">
	            <h2 class="secondary-heading">Contribuciones</h2>
	         	<div class="flex-container align-items-center">
					<div class="form-controls-container width-80p">
			            <mat-form-field>
			                <input matInput [placeholder]="'Contribuciones'" formControlName="contribution" [matAutocomplete]="autoContrib">
			                <mat-autocomplete autoActiveFirstOption [displayWith]="displayContribTitle" #autoContrib="matAutocomplete">
			                  <mat-option *ngFor="let item of contributions" [value]="item">
			                    {{item.title}}
			                  </mat-option>
			                </mat-autocomplete>     
			            </mat-form-field>       			
					</div> 
		        <div>
				        <button mat-mini-fab type="button" color="accent" (click)="addContribution()">
				          <mat-icon>add</mat-icon>
				        </button>
				    </div> 			
	         	</div>
	            <div formArrayName="contributionForm">
	 				<div *ngFor="let control of f['contributionForm'].controls; index as i">
	 					<div class="flex-container align-items-center">
	 						<div class="form-controls-container width-40p">
	 							<mat-label>{{contributionsAdded[i].title}}</mat-label>
	 						</div>
						  <div class="form-controls-container width-40p">
						  	<mat-form-field>
		              <input type="text" matInput  [placeholder]="'Monto'" [formControlName]="i">
		              <app-control-messages [control]="control"></app-control-messages>
					      </mat-form-field>	
						  </div>
						  <div>
				        <button mat-mini-fab type="button" color="accent" (click)="deleteContribution(i)">
				          <mat-icon>delete</mat-icon>
				        </button>
				    	</div>
	 					</div>
				    </div>
			  	</div>
			  </div>
        <div class="form-controls-container">
          <div class="btn-group">
            <button mat-raised-button color="primary" type="submit" [disabled]="paymentForm.invalid">Submit</button>
            <button mat-raised-button color="warn" type="button" (click)="onClear()">Clear</button>
          </div>
        </div>
	     </div>
	    </form>
  	</fieldset>
  	<ng-template #noNeighbors>
    	<div>No hay vecinos registrados</div>
  	</ng-template>
</ng-container>
<ng-template #loading>
  <div class="center">
    <mat-spinner color="accent" diameter="70"></mat-spinner>
  </div>
</ng-template>