<ng-container *ngIf="(neighbors$ | async) as neighbors; else loading">
  <fieldset [disabled]="isLoading" *ngIf="neighbors.length > 0; else noNeighbors">
    <form (ngSubmit)="createPayment()" [formGroup]="paymentForm">
      <mat-grid-list cols="2" rowHeight="1:1">
        <div class="start-mat-grid-list">
          <mat-grid-tile>
            <div class="form-controls-container">
              <h2 class="secondary-heading">Datos de vecino</h2>          
                <mat-form-field>
                  <input matInput [placeholder]="'Vecino'" formControlName="neighbor" [matAutocomplete]="auto" (change)="neighborInputChange($event)" required>
                  <mat-autocomplete autoActiveFirstOption [displayWith]="displayNeighborName" (optionSelected)="neighborOptionSelected($event)" #auto="matAutocomplete">
                    <mat-option *ngFor="let neighbor of filteredNeighbors$ | async" [value]="neighbor">
                      {{neighbor.fullName}}
                    </mat-option>
                  </mat-autocomplete>
                  <app-control-messages [control]="f['neighbor']"></app-control-messages>        
                </mat-form-field>
                <mat-form-field>
                  <input matInput readonly="true" [placeholder]="'Cedula'" formControlName="neighborID" required>
                  <app-control-messages [control]="f['neighborID']"></app-control-messages>
                </mat-form-field>
            </div>
          </mat-grid-tile>    
          <mat-grid-tile>
            <div class="form-controls-container"> 
              <h2 class="secondary-heading">Datos del pago</h2>
              <mat-form-field appearance="fill">
                <mat-label>Choose a date</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="paymentDate" required>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                <app-control-messages [control]="f['paymentDate']"></app-control-messages>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Tipo de pago</mat-label>
                <select matNativeControl (change)="paymentMethodChange($event)" formControlName="paymentMethod" required>
                  <option 
                    *ngFor="let method of paymentMethods" 
                    [value]="method" 
                  >
                    {{method}}
                  </option>
                </select>
                <app-control-messages [control]="f['paymentMethod']"></app-control-messages>   
              </mat-form-field>
              <ng-container *ngIf="isElectronicPayment">
                <mat-form-field appearance="fill">
                  <mat-label>Banco</mat-label>
                  <select matNativeControl formControlName="bank" required>
                      <option *ngFor="let bank of banks$ | async" [value]="bank">
                      {{bank}}
                      </option>
                  </select>
                  <app-control-messages [control]="f['bank']"></app-control-messages>   
                </mat-form-field>  
                <mat-form-field>
                  <input matInput [placeholder]="'Numero de referencia'" formControlName="paymentID" required>
                  <app-control-messages [control]="f['paymentID']"></app-control-messages>
                </mat-form-field>
              </ng-container>
              <mat-form-field>
                <input type="number" matInput  [placeholder]="'Monto'" formControlName="amount">
                <app-control-messages [control]="f['amount']"></app-control-messages>
              </mat-form-field>
              <div class="btn-group">
                <button mat-raised-button color="primary" type="submit" [disabled]="paymentForm.invalid">Submit</button>
                <button mat-raised-button color="warn" type="button" (click)="onClear()">Clear</button>
              </div>
            </div>
          </mat-grid-tile>      
          <mat-grid-tile *ngIf="(monthlyPayments$ | async) as monthlyPayments">
            <div class="form-controls-container">
              <h2 class="secondary-heading">Mensualidades a pagar</h2>
              <mat-selection-list >
                <mat-list-option *ngFor="let monthlyPayment of monthlyPayments">
                  {{monthlyPayment.month}} {{monthlyPayment.year}}
                </mat-list-option>
              </mat-selection-list>
            </div>
          </mat-grid-tile>   
        </div>
      </mat-grid-list>
    </form>
  </fieldset>
  <ng-template #noNeighbors>
    <div>No hay vecinos registrados</div>
  </ng-template>
</ng-container>
<ng-template #loading>
  <div class="center">
    <mat-spinner color="accent" diameter="70"></mat-spinner>
  </div>
</ng-template>