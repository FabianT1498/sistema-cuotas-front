<form (ngSubmit)="createPayment()" [formGroup]="paymentForm">
	
	<mat-horizontal-stepper formArrayName="paymentFormArr" linear>

		<ng-container *ngIf="paymentForm">
			<mat-step 
				formGroupName="0" 
				[stepControl]="f['paymentFormArr'].get([0])" 
				label="Datos del vecino"
			>			
				<div class="flex-container">
					
					<div class="item-flex">
						<mat-form-field>
							<input 
								matInput 
								[placeholder]="'Cedula del vecino'" 
								formControlName="neighborDNI" 
								(keyup)="neighborDNIChange($event)" 
								required
							>
							<app-control-messages [control]="f['paymentFormArr'].get([0]).controls['neighborDNI']"></app-control-messages>    
						</mat-form-field>
					</div>
					
					<ng-container #neighborContainer></ng-container>
					<ng-template #neighborFound>
						<div class="item-flex"> {{neighbor.fullName}} </div>
					</ng-template>
					<ng-template #neighborNotFound>
						<div class="item-flex">
							<span class="mr-md-3">Este vecino no esta registrado, presione el boton para registrarlo</span>	
							<button mat-mini-fab type="button" color="accent" (click)="addNeighbor()">
								<mat-icon>add</mat-icon>
							</button>						
						</div>
					</ng-template>
					<ng-template #newNeighbor>
						<div class="item-flex">
							<mat-form-field>
								<input 
									matInput 
									[placeholder]="'Nombre del vecino'" 
									formControlName="fullName"  
									required
								>
								<app-control-messages [control]="f['paymentFormArr'].get([0]).controls['fullName']"></app-control-messages>  
						
							</mat-form-field>
						</div>
						<div class="item-flex">
							<mat-form-field>
								<input 
									matInput 
									[placeholder]="'Telefono del vecino'" 
									formControlName="phoneNumber"
								>
								<app-control-messages [control]="f['paymentFormArr'].get([0]).controls['phoneNumber']"></app-control-messages>  
						
							</mat-form-field>
						</div>
						<div class="item-flex">
							<mat-form-field>
								<input 
									matInput 
									[placeholder]="'Correo del vecino'" 
									formControlName="email"
								>
								<app-control-messages [control]="f['paymentFormArr'].get([0]).controls['email']"></app-control-messages>  
							</mat-form-field>
						</div>
						<div class="item-flex">
							<mat-form-field>
								<input 
									matInput 
									[placeholder]="'NÃºmero de casa'" 
									formControlName="houseNumber"
								>
								<app-control-messages [control]="f['paymentFormArr'].get([0]).controls['houseNumber']"></app-control-messages>  
						
							</mat-form-field>
						</div>
					</ng-template>
				</div>
				
				<div>
					<button mat-button matStepperNext type="button">Siguiente</button>
				</div>

			</mat-step>
		</ng-container>	
	</mat-horizontal-stepper>

	
			<!-- <div class="form-controls-container"> 
			<h2 class="secondary-heading">Datos del pago</h2>
			<mat-form-field appearance="fill">
				<mat-label>Selecciona una fecha</mat-label>
				<input matInput [matDatepicker]="picker" formControlName="paymentDate" required>
				<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
				<mat-datepicker #picker></mat-datepicker>
				<app-control-messages [control]="f['paymentDate']"></app-control-messages>
			</mat-form-field>
			<mat-form-field appearance="fill">
				<mat-label>Tipo de pago</mat-label>
				<select matNativeControl (change)="paymentMethodChange($event)" formControlName="paymentMethod" required>
				<option 
					*ngFor="let method of paymentMethods" 
					[value]="method" 
				>
					{{method}}
				</option>
				</select>
				<app-control-messages [control]="f['paymentMethod']"></app-control-messages>   
			</mat-form-field>
			<ng-container *ngIf="isElectronicPayment">
				<mat-form-field appearance="fill">
				<mat-label>Banco</mat-label>
				<select matNativeControl formControlName="bank" required>
					<option *ngFor="let bank of banks$ | async" [value]="bank">
					{{bank}}
					</option>
				</select>
				<app-control-messages [control]="f['bank']"></app-control-messages>   
				</mat-form-field>  
				<mat-form-field>
				<input matInput [placeholder]="'Numero de referencia'" formControlName="paymentID" required>
				<app-control-messages [control]="f['paymentID']"></app-control-messages>
				</mat-form-field>
			</ng-container>
			<mat-form-field>
				<input type="text" matInput  [placeholder]="'Monto'" formControlName="amount">
				<app-control-messages [control]="f['amount']"></app-control-messages>
			</mat-form-field>
			</div>
			<div class="form-controls-container" *ngIf="(monthlyPayments$ | async) as monthlyPayments">
			<h2 class="secondary-heading">Mensualidades por pagar</h2>
			<mat-form-field appearance="fill">
				<mat-label>Mensualidades</mat-label>
				<mat-select formControlName="monthlyPayments" multiple>
				<mat-option *ngFor="let item of monthlyPayments" [value]="item">{{item.month}} {{item.year}}</mat-option>
				</mat-select>       
			</mat-form-field>
			</div>
			<div class="form-controls-container" *ngIf="(repairs$ | async) as repairs">
			<h2 class="secondary-heading">Reparaciones por pagar</h2>
			<mat-form-field appearance="fill">
				<mat-label>Reparaciones</mat-label>
				<mat-select formControlName="repairs" multiple>
				<mat-option *ngFor="let item of repairs" [value]="item">{{item.title}} - {{item.cost}}</mat-option>
				</mat-select>   
			</mat-form-field>
			</div>
			<div class="form-controls-container" *ngIf="(contributions$ | async) as contributions">
			<h2 class="secondary-heading">Contribuciones</h2>
			<div class="flex-container align-items-center">
				<div class="form-controls-container width-80p">
					<mat-form-field>
						<input matInput [placeholder]="'Contribuciones'" formControlName="contribution" [matAutocomplete]="autoContrib">
						<mat-autocomplete autoActiveFirstOption [displayWith]="displayContribTitle" #autoContrib="matAutocomplete">
							<mat-option *ngFor="let item of contributions" [value]="item">
							{{item.title}}
							</mat-option>
						</mat-autocomplete>     
					</mat-form-field>       			
				</div> 
			<div>
					<button mat-mini-fab type="button" color="accent" (click)="addContribution()">
						<mat-icon>add</mat-icon>
					</button>
				</div> 			
			</div>
			<div formArrayName="contributionForm">
				<div *ngFor="let control of f['contributionForm'].controls; index as i">
					<div class="flex-container align-items-center">
						<div class="form-controls-container width-40p">
							<mat-label>{{contributionsAdded[i].title}}</mat-label>
						</div>
						<div class="form-controls-container width-40p">
						<mat-form-field>
					<input type="text" matInput  [placeholder]="'Monto'" [formControlName]="i">
					<app-control-messages [control]="control"></app-control-messages>
						</mat-form-field>	
						</div>
						<div>
					<button mat-mini-fab type="button" color="accent" (click)="deleteContribution(i)">
						<mat-icon>delete</mat-icon>
					</button>
					</div>
					</div>
				</div>
			</div>
			</div>
	<div class="form-controls-container">
		<div class="btn-group">
		<button mat-raised-button color="primary" type="submit" [disabled]="paymentForm.invalid">Submit</button>
		<button mat-raised-button color="warn" type="button" (click)="onClear()">Clear</button>
		</div>
	</div> -->
	
</form>
		
<!-- <ng-template #loading>
  <div class="center">
    <mat-spinner color="accent" diameter="70"></mat-spinner>
  </div>
</ng-template> -->